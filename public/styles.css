/* Knights & Kings Ã¢â‚¬â€ responsive UI (desktop + mobile) */

/* =========================
   THEME TOKENS
========================= */
:root{
  --bg0:#0b0f16;
  --panel:#0d1118cc;
  --stroke:#ffffff12;
  --stroke2:#ffffff1f;
  --text:#e9eef7;
  --muted:#b7c2d6;
  --navy:#16243a;
  --lightSq:#f4f6f8;
  --darkSq:#1f2e4b;
  --gold:#e6ea5a;

  --headerH:64px;
  --gap:22px;
  --panelW:340px;

  --boardSize: min(72vh, 52vw, 720px);
  --borderW:12px;
}

*{ box-sizing:border-box; }

html,body{
  height:100%;
  margin:0;
  overflow:hidden; /* keep page locked; we scroll inside main on mobile */
  background: radial-gradient(1200px 700px at 50% 0%, #141b28 0%, var(--bg0) 55%, #070a10 100%);
  color:var(--text);
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
}

/* =========================
   TOP BAR
========================= */
header.topbar{
  height:var(--headerH);
  padding:14px 18px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:14px;
  border-bottom:1px solid var(--stroke);
  background: linear-gradient(180deg, #0c1018 0%, #090c12 100%);
}

.brand{
  display:flex;
  align-items:center;
  gap:10px;
  min-width: 44px;
}
.brandLogo{
  height:36px; /* never increases header */
  width:auto;
  object-fit:contain;
  display:block;
}
.brandText{
  position:absolute;
  left:-9999px;
  width:1px;
  height:1px;
  overflow:hidden;
}

.status{
  opacity:.85;
  font-weight:600;
  font-size:14px;
  white-space:nowrap;
}

.actions{
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:nowrap;
}

.toggle{
  display:flex;
  align-items:center;
  gap:8px;
  font-weight:700;
  color:var(--text);
  user-select:none;
  white-space:nowrap;
}

button{
  appearance:none;
  border:1px solid var(--stroke2);
  color:var(--text);
  background: linear-gradient(180deg, #1a2232 0%, #121826 100%);
  border-radius:12px;
  padding:9px 14px;
  font-weight:800;
  cursor:pointer;
}
button:hover{ border-color:#ffffff33; }
button:disabled{ opacity:.45; cursor:not-allowed; }

/* =========================
   APP LAYOUT (DESKTOP)
========================= */
main.layout{
  height:calc(100vh - var(--headerH));
  display:grid;
  grid-template-columns: var(--panelW) 1fr var(--panelW);
  gap:var(--gap);
  padding:18px;
  align-items:start;
  min-height:0;
}

.panel{
  background: var(--panel);
  border:1px solid var(--stroke);
  border-radius:18px;
  padding:18px;
  box-shadow: 0 20px 50px #00000055;
  min-height: 0; /* allow internal scrollers */
}

.panel h2{
  margin:0 0 12px 0;
  font-size:34px;
  letter-spacing:-.5px;
}

.pillRow{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin:10px 0 16px;
}
.pill{
  border:1px solid var(--stroke2);
  background:#0b0f16aa;
  padding:6px 10px;
  border-radius:999px;
  font-weight:800;
  color:var(--muted);
  font-size:13px;
}

.hint{ font-weight:700; color:var(--text); margin:6px 0 8px; }
.hintSmall{ color:var(--muted); font-size:13px; min-height:18px; }

.btnRow{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:10px;
}

.debug, #debug{
  margin-top:14px;
  padding:12px;
  background:#06080dcc;
  border:1px solid var(--stroke);
  border-radius:14px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size:12px;
  line-height:1.35;
  max-height: 40vh;
  overflow:auto;
  white-space:pre;
}

.log, #log{
  margin-top:12px;
  padding:12px;
  background:#06080dcc;
  border:1px solid var(--stroke);
  border-radius:14px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size:12px;
  line-height:1.35;
  max-height: 55vh;
  overflow:auto;
  white-space:pre-wrap;
}

/* =========================
   BOARD
========================= */
.boardWrap{
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:0;
  padding-top:6px;
}

.boardFrame{
  display:grid;
  grid-template-columns: auto 1fr;
  grid-template-rows: 1fr auto;
  gap:14px 18px;
  align-items:center;
  justify-items:center;
}

.rankLabels{
  grid-column:1;
  grid-row:1;
  display:grid;
  grid-template-rows: repeat(8, 1fr);
  align-items:center;
  justify-items:end;
  height: calc(var(--boardSize) + (var(--borderW) * 2));
  padding-right:6px;
  font-family: "Cinzel", Georgia, "Times New Roman", serif;
  font-weight:800;
  font-size: clamp(18px, 2.4vh, 30px);
  color:#ffffff;
  text-shadow: 0 2px 10px #00000066;
  user-select:none;
}

.fileLabels{
  grid-column:2;
  grid-row:2;
  display:grid;
  grid-template-columns: repeat(8, 1fr);
  align-items:start;
  justify-items:center;
  width: calc(var(--boardSize) + (var(--borderW) * 2));
  padding-top:8px;
  font-family: "Cinzel", Georgia, "Times New Roman", serif;
  font-weight:800;
  font-size: clamp(18px, 2.4vh, 30px);
  color:#ffffff;
  text-shadow: 0 2px 10px #00000066;
  user-select:none;
}

.boardOuter{
  grid-column:2;
  grid-row:1;
  background: var(--gold);
  padding: var(--borderW);
  border-radius: 2px;
  box-shadow: 0 18px 40px #00000055;
}

#board.board{
  width: var(--boardSize);
  height: var(--boardSize);
  display:grid;
  grid-template-columns: repeat(8, 1fr);
  grid-template-rows: repeat(8, 1fr);
  background: var(--navy);
  overflow:hidden;
}

.square{
  display:flex;
  align-items:center;
  justify-content:center;
  user-select:none;
  position:relative;
}

.square.light{ background: var(--lightSq); }
.square.dark{ background: var(--darkSq); }

.square.selected{
  outline: 3px solid #ffffffaa;
  outline-offset: -3px;
}

.square:hover{ filter: brightness(1.05); }

.square img,
.square img.pieceImg{
  width:72%;
  height:72%;
  object-fit:contain;
  pointer-events:none;
}

/* =========================
   HAND GRID
========================= */
.panel.rightPanel{ display:flex; flex-direction:column; }
#hand{ margin-top:14px; }

.handList, .handGrid{
  display:grid;
  grid-template-columns:repeat(3, minmax(0, 1fr));
  gap:12px;
  align-content:start;
}

.handCard{
  width:100%;
  height:96px;
  background:rgba(255,255,255,0.04);
  border:1px solid rgba(255,255,255,0.12);
  border-radius:16px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:8px;
  cursor:pointer;
  transition:transform .08s ease, border-color .15s ease, box-shadow .15s ease;
}
.handCard:hover{ transform:translateY(-1px); }
.handCard.selected{
  border-color:rgba(235,255,85,0.9);
  box-shadow:0 0 0 2px rgba(235,255,85,0.25) inset;
}
.handCardIcon{
  width:44px;
  height:44px;
  object-fit:contain;
  filter:drop-shadow(0 2px 2px rgba(0,0,0,0.35));
}
.handCardLabel{ font-size:12px; letter-spacing:0.06em; opacity:0.95; }

/* =========================
   MODAL
========================= */
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.55);display:flex;align-items:center;justify-content:center;z-index:9999;}
.modal.hidden{display:none;}
.modalBackdrop{position:absolute;inset:0;}
.modalCard{position:relative;width:min(520px, calc(100vw - 36px));background:rgba(15,18,24,0.92);border:1px solid rgba(255,255,255,0.14);border-radius:18px;box-shadow:0 18px 70px rgba(0,0,0,0.55);backdrop-filter: blur(12px);padding:16px 16px 14px;}
.modalHeader{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:10px;}
.modalHeader h3{margin:0;font-size:18px;letter-spacing:0.02em;}
.modalOptions .modalBtn{ width:100%; margin:6px 0; }
.modalFooter{ margin-top:12px; display:flex; justify-content:flex-end; }
.modalCancel{ padding:10px 14px; }

/* =========================
   MOVE ANIMATION LAYER
========================= */
#moveLayer{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:9998;
}
.moveGhost{
  position:fixed;
  pointer-events:none;
  filter: drop-shadow(0 10px 14px rgba(0,0,0,0.55));
  will-change: transform, opacity;
}

/* =========================
   RESPONSIVE TUNING
========================= */
@media (max-width: 1180px){
  :root{ --panelW: 320px; --boardSize: min(70vh, 50vw, 640px); }
}
@media (max-width: 1040px){
  :root{ --panelW: 300px; --boardSize: min(68vh, 54vw, 600px); }
  main.layout{ gap:16px; padding:14px; }
}
@media (max-width: 920px){
  /* KEY MOBILE FIX:
     - single column
     - main.layout scrolls internally
     - board fits the screen width
     - panels never overlap board because everything stays in normal flow
  */
  :root{
    --gap:12px;
    --borderW:10px;
    --boardSize: min(78vw, 520px);
  }

  header.topbar{
    padding:10px 12px;
    gap:10px;
  }

  /* Hide status on phones (it was pushing layout) */
  .status{ display:none; }

  .actions{
    gap:8px;
  }

  button{
    padding:8px 12px;
    border-radius:12px;
    font-size:14px;
  }

  main.layout{
    display:flex;
    flex-direction:column;
    gap: var(--gap);
    padding:12px;

    height:calc(100vh - var(--headerH));
    overflow:auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }

  /* Ensure these sections stay in flow and never overlay */
  .boardWrap{ order:1; padding-top:0; }
  .panel.leftPanel{ order:2; }
  .panel.rightPanel{ order:3; }

  .panel{
    padding:14px;
    border-radius:16px;
  }

  .panel h2{ font-size:28px; }

  .rankLabels, .fileLabels{
    font-size: clamp(14px, 2.1vh, 22px);
  }

  /* Make the board + labels fit narrower screens */
  .boardFrame{
    gap:10px 12px;
  }

  /* Hand becomes 2-across */
  .handList, .handGrid{
    grid-template-columns:repeat(2, minmax(0, 1fr));
    gap:10px;
  }
  .handCard{ height:86px; border-radius:14px; }
  .handCardIcon{ width:40px; height:40px; }
  .handCardLabel{ font-size:11px; }

  /* Keep debug/log from dominating */
  #log{ max-height: 24vh; }
  #debug{ max-height: 20vh; }
}

/* Smaller phones */
@media (max-width: 420px){
  :root{ --boardSize: min(84vw, 480px); }
  button{ font-size:13px; padding:8px 10px; }
  .toggle{ font-size:13px; }
}


/* =========================
   END GAME BANNER (AI MODE)
========================= */

.endBanner{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:10001;
  padding:18px;
}
.endBanner.hidden{ display:none; }

.endBannerBackdrop{
  position:absolute;
  inset:0;
  background: rgba(0,0,0,0.68);
  backdrop-filter: blur(10px);
}

.endBannerCard{
  position:relative;
  z-index:1;
  width:min(760px, 92vw);
  border-radius:18px;
  border:1px solid rgba(255,255,255,0.18);
  background: rgba(10,12,18,0.55);
  box-shadow: 0 24px 90px rgba(0,0,0,0.6);
  overflow:hidden;
  transform: translateY(6px) scale(0.98);
  opacity:0;
  animation: endBannerPop 260ms cubic-bezier(.2,.9,.2,1) forwards;
}

@keyframes endBannerPop{
  to{ transform: translateY(0) scale(1); opacity:1; }
}

.endBannerImg{
  display:block;
  width:100%;
  height:auto;
}

.endBannerActions{
  display:flex;
  gap:10px;
  justify-content:flex-end;
  padding:12px;
  background: linear-gradient(180deg, rgba(8,10,14,0.0) 0%, rgba(8,10,14,0.75) 100%);
}

.endBannerClose{
  border-color: rgba(255,255,255,0.26);
}
